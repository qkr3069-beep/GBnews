<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>거북식당 뉴스 브리핑</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Pretendard Variable -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />
  <style>
    :root{
      /* 거북식당 로고 톤 */
      --brand-primary:#1F3A3D;      /* 로고 글자색 */
      --brand-primary-700:#F5F0E6;  /* 베이지 배경 */
      --brand-primary-50:#F5F0E6;   /* 베이지 배경 */

      --brand-text:#1F3A3D;
      --brand-muted:#6B7280;
      --brand-card:#ffffff;
      --brand-divider:#e5e7eb;

      --brand-radius:14px;
      --brand-shadow:0 6px 18px rgba(31,58,61,0.08);
    }
    html,body{
      font-family:"Pretendard Variable",Pretendard,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
        "Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic","맑은 고딕",Arial,"Helvetica Neue",Helvetica,sans-serif;
    }
    .brand-header{ background: linear-gradient(90deg,var(--brand-primary-700) 0%,var(--brand-primary-700) 100%); }
    .brand-btn{
      background:var(--brand-primary); color:#fff; border-radius:9999px; padding:10px 18px; font-weight:700;
      box-shadow:var(--brand-shadow); transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
    }
    .brand-btn:hover{ background:var(--brand-primary-700); transform:translateY(-1px); }

    .title-brand{ color:var(--brand-primary); }     /* 타이틀 색 고정 */
    .brand-link{ color:var(--brand-primary); font-weight:700; }  /* 기사 제목(링크) 색 고정 */
    .brand-link:hover{ text-decoration:underline; }

    .brand-section-title{
      color:var(--brand-text); font-weight:800; border-left:6px solid var(--brand-primary);
      padding-left:10px; margin-bottom:14px;
    }
    .brand-card{
      background:var(--brand-card); border-radius:var(--brand-radius); box-shadow:var(--brand-shadow);
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease; border:1px solid transparent;
    }
    .brand-card:hover{
      transform:translateY(-2px); box-shadow:0 10px 26px rgba(31,58,61,0.12); border-color:var(--brand-divider);
    }
    .brand-sub{ color:var(--brand-muted); }
    .brand-wrap{ background:var(--brand-primary-50); }
    .brand-divider{ border-top:1px dashed var(--brand-divider); }

    /* ✅ 반응형 배너: 어떤 이미지 사이즈든 컨테이너 가로폭에 맞춤 */
    .ad-banner{
      width:100%;
      border-radius:16px;
      overflow:hidden;           /* 둥근 모서리 클리핑 */
      box-shadow:var(--brand-shadow);
      background:#fff;          /* 투명 PNG 대비 */
    }
    .ad-banner img{
      display:block;
      width:100%;               /* 가로폭 채우기 */
      height:auto;              /* 비율 유지 (잘림 없음) */
    }
  </style>
</head>
<body class="text-[var(--brand-text)] brand-wrap min-h-screen">

  <!-- 헤더 (모바일: 세로 스택 / 데스크탑: 가로 배치) -->
  <header class="brand-header text-white">
    <div class="max-w-6xl mx-auto px-5 py-6 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div class="flex flex-col gap-1">
        <div class="flex">
          <!-- 로고 이미지 -->
          <img src="https://raw.githubusercontent.com/qkr3069-beep/GBnews/135027c8bc3793e3345215df0662a3422f00843c/%EA%B7%B8%EB%A6%BC2.png" 
               alt="거북식당 로고" class="w-100 h-24 object-contain" />
        </div>
        <div class="flex flex-wrap items-center gap-3">
          <!-- ✅ 타이틀 색을 로고 텍스트색과 동일하게 -->
          <h1 class="title-brand text-xl lg:text-2xl font-extrabold tracking-tight">거북식당 뉴스 브리핑</h1>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <input type="date" id="datePicker" class="px-3 py-2 rounded-xl text-[var(--brand-text)] bg-white outline-none focus:ring-2 ring-[var(--brand-primary)] w-full sm:w-auto" />
        <button onclick="loadAllNews()" class="brand-btn">조회</button>
      </div>
    </div>
  </header>

  <!-- 본문 -->
  <main class="max-w-6xl mx-auto px-5 py-0 space-y-3">
    <div class="brand-divider"></div>

    <!-- ✅ 가로폭에 자동 맞는 배너 (주요 소식(국내) 위) -->
    <div class="mb-4">
      <a class="ad-banner block" href="https://omnicare.biz/service/service.php" target="_blank" rel="noopener">
        <!-- 어떤 사이즈 이미지를 넣어도 w=100%로 맞춰짐 -->
        <img src="https://github.com/qkr3069-beep/GBnews/blob/main/%EA%B4%91%EA%B3%A0%20%EC%83%98%ED%94%8C2.jpg?raw=true" alt="광고 배너">
      </a>
    </div>

    <div id="news-container" class="space-y-3"></div>
  </main>

  <script>
  const feeds = {
    "주요 소식(국내)": "https://news.google.com/rss?hl=ko&gl=KR&ceid=KR:ko",
    "주요 소식(국외)": "https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en",
    "경제/사회": "https://news.google.com/rss/search?q=경제+OR+사회&hl=ko&gl=KR&ceid=KR:ko",
    "제조업 소식": "https://news.google.com/rss/search?q=제조업+OR+반도체+OR+자동차+OR+배터리+OR+디스플레이+OR+조선&hl=ko&gl=KR&ceid=KR:ko"
  };

  async function fetchRSS(url) {
    const apiUrl = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(url);
    const res = await fetch(apiUrl);
    return await res.json();
  }

  function cleanText(t) {
    return (t || "").replace(/<[^>]+>/g, " ").replace(/&[a-z]+;/gi, " ").replace(/\s+/g, " ").trim();
  }
  function makeSubdesc(desc) {
    const t = cleanText(desc);
    return t.length > 60 ? t.slice(0, 60) + "..." : t;
  }

  // ✅ Safari-safe 날짜 파싱
  function parseYMD(ymd) {
    const [y, m, d] = ymd.split('-').map(Number);
    return new Date(y, m - 1, d);
  }

  function isSameDate(pubDate, selectedDate) {
    const d = new Date(pubDate);
    const sel = parseYMD(selectedDate);  // ← 이 부분 교체
    const diff = Math.abs((d - sel) / (1000 * 60 * 60 * 24));
    return diff <= 1;
  }

  function makeKey(title, link) { return (title || "").replace(/\s+/g, "") + (link || ""); }

  function renderSection(container, category, items, selectedDate){
    const maxCount = category === "제조업 소식" ? 10 : 5;
    let count = 0;
    const seen = new Set();

    const section = document.createElement("section");
    section.innerHTML = `<h2 class="brand-section-title text-xl">${category}</h2>`;

    for (const item of items) {
      if (count >= maxCount) break;
      if (!isSameDate(item.pubDate, selectedDate)) continue;

      const title = (item.title || "").trim();
      const link  = item.link || "#";
      const desc  = item.description || "";
      const key   = makeKey(title, link);
      if (seen.has(key)) continue;
      seen.add(key);

      const subdesc = makeSubdesc(desc);
      const card = document.createElement("div");
      card.className = "brand-card mb-4 p-4";
      card.innerHTML = `
        <a href="${link}" target="_blank" class="brand-link block mb-1">${title}</a>
        <p class="text-sm brand-sub">${subdesc}</p>
      `;
      section.appendChild(card);
      count++;
    }

    if (count === 0) {
      section.innerHTML += `<p class="brand-sub">해당 날짜에 기사가 없습니다.</p>`;
    }

    const divider = document.createElement("div");
    divider.className = "brand-divider mt-6 mb-8";
    container.appendChild(section);
    container.appendChild(divider);
  }

  async function loadAllNews(){
    const selectedDate = document.getElementById("datePicker").value;
    const container = document.getElementById("news-container");
    container.innerHTML = "";
    for (const [category, url] of Object.entries(feeds)) {
      const data = await fetchRSS(url);
      const items = Array.isArray(data.items) ? data.items : [];
      renderSection(container, category, items, selectedDate);
    }
  }

  window.onload = () => {
    const today = new Date().toISOString().slice(0, 10);
    document.getElementById("datePicker").value = today;
    loadAllNews();
  }
</script>
</body>
</html>

